I"(8<h1 id="nyc311-housing-and-building-complaint-analysis">NYC311 Housing and Building Complaint Analysis</h1>

<h2 id="problem-statement">Problem Statement</h2>

<h3 id="about-nyc311">About NYC311</h3>

<p>NYC311 by the New York City government provides the public with government and non-emergency services. Complaints will be forwarded to various agencies such as local governments, public utilities, and other public services. Citizens can file a complaint about various problem, such as illegal parking, noise, heating, and apartment maintenance. The complaints are coming from five boroughs, which are Queens, Brooklyn, Bronx, Staten Island, and Manhattan.</p>

<h3 id="housing-and-buildings-complaints">Housing and Buildings Complaints</h3>

<p>Department of Housing Preservation and Development (HPD) is the agency responsible to process the complaints related to housing and building. HPD fields most reports, <a href="https://council.nyc.gov/data/311-agency/">second only to the NYC Police Department</a>.</p>

<p><img src="/portfolio/static/totalcall.png" alt="" /></p>

<p>HPD is seeking help to manage the large volume of complaints by focusing on the most pressing complaint and determine the possibility of the complaints. This analysis provides insight to the trends of the complaint received by HPD.</p>

<p>We also investigate the relationship between building characteristics with the complaint type of our focus.</p>

<h2 id="datasets">Datasets</h2>

<h3 id="nyc-311-service-requests">NYC 311 Service Requests</h3>
<ul>
  <li>Complaint details such as complaint type, location and address, complaint response, status.</li>
  <li>Raw dataset: &gt;10M rows, 16 columns</li>
</ul>

<h3 id="pluto-dataset">PLUTO Dataset</h3>
<ul>
  <li>The Primary Land Use Tax Lot Output by NYC Department of City Planning. Contains land use and geographic data at tax lot level.</li>
  <li>Raw dataset: 89k rows, 87 columns</li>
</ul>

<h2 id="exploratory-data-analysis">Exploratory Data Analysis</h2>

<h3 id="top-10-complaints-in-2015---2019">Top 10 Complaints in 2015 - 2019</h3>

<p>There are 14 types of complaints under Housing and Buildings category, with HEAT/HOT WATER having the highest number of complaints. This type of complaint comprises 37.9% of the total complaints on housing and buildings.</p>

<p>Building owners are required to meet the heat requirements according to the law. This includes residential building, commercial building, and other public facilities such as child care, nursing home, homeless shelter, and public school. When the heat requirements are not met, citizens can file a complaint. The NYC311 Service does not serve complaints coming from private homes, apartments, and other residential spaces.</p>

<p>Bronx has the highest number of HEAT/HOT WATER complaints from 2015 - 2019, followed closely with Brooklyn. On the other hand, Bronx only has <a href="https://data.cityofnewyork.us/City-Government/NYC-Population-by-Borough/h2bk-zmw6/data">population of 2.7 million</a>, the fourth highest after Brooklyn, Queens, and Manhattan. This means the heat complaint in Bronx has the highest density compared in the other borough.</p>

<p class="text-center">More than 1/3 of housing and buildings complaints are HEAT/HOT WATER complaints.</p>

<p><img src="/portfolio/static/top10.png" alt="" /></p>

<h3 id="heat-complaints-at-borough-level">Heat Complaints at Borough Level</h3>

<p>Bronx has the highest number of HEAT/HOT WATER complaints despite being only the 4th most-populated borough. This suggests that Bronx has the highest heat complaints density.</p>

<p><img src="/portfolio/static/heatborough.png" alt="" /></p>

<p><img src="/portfolio/static/nycpop.png" alt="" /></p>

<p>Our analysis will focus on HEAT/HOT WATER complaints in Bronx.</p>

<h3 id="heat-complaints-map-at-zip-code-level">Heat Complaints Map at Zip Code Level</h3>

<p><img src="/portfolio/static/nyc heat map.png" alt="" /></p>

<h3 id="heat-complaints-pattern">Heat Complaints Pattern</h3>

<p>We can observe patterns in heat complaints throughout the year, week, and day. The <a href="https://portal.311.nyc.gov/article/?kanumber=KA-01036#:~:text=You%20can%20make%20a%20complaint,June%201%20and%20September%2030">city regulation</a> demands building owners to provide tenants with minimum heat requirements between Oct 1st and May 31. The heat requirements vary based on the hour and outside temperature. During work hours (6 AM - 10 PM) the heat requirement (minimum 68 degrees) is applied only if the outside temperature falls below 55 degrees. Outside that time window (during nighttime) heat should always meet the required temperature (minimum 62 degrees) without no specification about outside temperature.</p>

<p>The higher minimum temperature requirement during work hours (starts at 6 AM) explains the daily HEAT/HOT WATER complaint pattern which was very low during nighttime (0 - 5 AM) and started to rise at 6 AM time. This also explains the reason the number of HEAT/HOT WATER complaints stayed high even after normal work hour ends (~4 PM), while the other complaint types kept decresing until it reached nighttime.</p>

<p><img src="/portfolio/static/heathour.png" alt="" /></p>

<p><img src="/portfolio/static/patternday.png" alt="" /></p>

<p>The regulation specifies heat requirement during the day, which applies throughout the week during Oct 1 - May 31. Since there is no specific regulation on heat requirement during the week, there is no difference in number of HEAT/HOT WATER complaints throughout the week, even during weekend. This suggests that most HEAT/HOT WATER complaints come from residential building, unlike the other complaints that have lower number during the weekend.</p>

<p><img src="/portfolio/static/patternweek.png" alt="" /></p>

<p>While the other type of complaints have a relatively steady number of complaints throughout the year, HEAT/HOT WATER complaint has lowest number from late spring (June) until early fall (Sep). The HEAT/HOT WATER complaints about excessive heat are accepted only during this period.</p>

<p><img src="/portfolio/static/heatmonth.png" alt="" /></p>

<p><img src="/portfolio/static/patternmonth.png" alt="" /></p>

<h4 id="trends-throughout-the-year">Trends Throughout the Year</h4>

<p>We can look into heat complaint trends throughout the year by comparing the number of complaints and the average temperature in NYC in 2019. As expected, HEAT/HOT WATER complaints started happening in fall and peaked in January when the temperature hit the lowest. The highest peak of heat complaints happened in the same day during the lowest peak of temperature, which were Jan 21st and 31st. (dataset from <a href="https://www.ncdc.noaa.gov/cdo-web/search">NOAA</a>)</p>

<p><img src="/portfolio/static/patternmonth2.png" alt="" /></p>

<h4 id="complaint-volume-throughout-the-day">Complaint Volume Throughout the Day</h4>

<p>At any given hour, HEAT/HOT WATER has the highest number of complaints among the other under houses and buildings complaints.</p>

<p><img src="/portfolio/static/streamgraph-complaint.png" alt="" /></p>

<h2 id="predictive-modeling">Predictive Modeling</h2>

<h3 id="goal">Goal</h3>
<ul>
  <li>Predict whether a building will have a heat complaint at a certain time during a day on a certain month, given its characteristics.</li>
  <li>When the prediction is done for buildings at a certain area (for example zip code), we can tell the total heat complaint in that area and decide which area needs more attention</li>
</ul>

<h3 id="metrics">Metrics</h3>

<p>We care only about the positive class (heat complaints), thus we will use F1 score as the main metrics to evaluate our model.</p>

<h3 id="features-used">Features Used</h3>

<p>Dataset used was the NYC 311 Service Request and PLUTO Dataset merged on the incident address. There are 12 final features used:</p>

<table>
  <thead>
    <tr>
      <th>No</th>
      <th>Feature</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>month</td>
      <td>the month the complaint happens</td>
    </tr>
    <tr>
      <td>2</td>
      <td>OfficeArea</td>
      <td>an estimate of the exterior dimensions of the portion of the structure(s) allocated for office use</td>
    </tr>
    <tr>
      <td>3</td>
      <td>GarageArea</td>
      <td>an estimate of the exterior dimensions of the portion of the structure(s) allocated for garage use</td>
    </tr>
    <tr>
      <td>4</td>
      <td>StrgeArea</td>
      <td>an estimate of the exterior dimensions of the portion of the structure(s) allocated for storage use</td>
    </tr>
    <tr>
      <td>5</td>
      <td>ResArea</td>
      <td>an estimate of the exterior dimensions of the portion of the structure(s) allocated for residential use</td>
    </tr>
    <tr>
      <td>6</td>
      <td>BldgArea</td>
      <td>the total gross area in square feet</td>
    </tr>
    <tr>
      <td>7</td>
      <td>OtherArea</td>
      <td>allocated area other than for Residential, Office, Retail, Garage, Storage, Loft or Factory use</td>
    </tr>
    <tr>
      <td>8</td>
      <td>NumFloors</td>
      <td>in the tallest building on the tax lot, the number of full and partial stories starting from the ground floor</td>
    </tr>
    <tr>
      <td>9</td>
      <td>UnitsTotal</td>
      <td>the sum of residential and non-residential (offices, retail stores, etc.) units in all buildings on the tax lot</td>
    </tr>
    <tr>
      <td>10</td>
      <td>AssessTot</td>
      <td>the tentative assessed total value for Fiscal Year 2018</td>
    </tr>
    <tr>
      <td>11</td>
      <td>hourbin</td>
      <td>the hour time the complaint happens, mapped into early morning, morning, afternoon, and evening</td>
    </tr>
    <tr>
      <td>12</td>
      <td>bldgperlot</td>
      <td>building area per lot area</td>
    </tr>
  </tbody>
</table>

<h3 id="baseline-model">Baseline Model</h3>

<ol>
  <li>
    <p>Majority classifier</p>

    <p>Always predict the majority class, in this
 case 0 or “No” (not heat complaint), for the
 target value</p>
    <ul>
      <li>F1 score: 0</li>
      <li>Accuracy: 0.62</li>
    </ul>
  </li>
  <li>
    <p>Single feature</p>

    <p>The class is predicted by only one variable.
 We will make a decision tree with only one
 decision level with the most-informative
 feature (decision stump).</p>
    <ul>
      <li>F1 score: 0.42</li>
      <li>Accuracy: 0.64</li>
    </ul>
  </li>
</ol>

<h3 id="benchmark-model">Benchmark Model</h3>

<p>Cross -validate using combination of several models and strategies on train and evaluation set. The models used are:</p>

<ol>
  <li>Logistic Regression</li>
  <li>Decision Tree Classifier</li>
  <li>Stochastic Gradient Descent</li>
  <li>Naive Bayes</li>
</ol>

<p>the strategy used for these pipelines are:</p>
<ol>
  <li>Oversampling with SMOTE</li>
  <li>Scaling with MinMaxScaler</li>
  <li>Feature selection with RFE</li>
  <li>Oversampling with RandomOverSampler</li>
  <li>Combined oversampling (SMOTE) and
  undersampling (TomekLinks) with SMOTETomek</li>
  <li>Combined oversampling (SMOTE) and
  undersampling (ENN - Edited Nearest
  Neighbours)with SMOTEENN</li>
</ol>

<p><img src="/portfolio/static/bestmodel.png" alt="" /></p>

<h3 id="model-improvement">Model Improvement</h3>

<p>Improve the benchmark model (DecisionTreeClassifier with scaling and SMOTE-ENN) with these strategies:</p>

<ol>
  <li>Boosting with AdaBoostClassifier</li>
  <li>Bagging with RandomTreeClassifier</li>
  <li>Hyperparameter Tuning</li>
</ol>

<p>Fit model with train and validation dataset, then evaluate on test dataset.</p>

<h3 id="best-model">Best Model</h3>

<p>Random Tree Classifier with 50 estimators and maximum depth of 20 has the best result with F1 score and accuracy of 0.67. The most important feature is <code class="language-plaintext highlighter-rouge">month</code>.</p>

<p><img src="/portfolio/static/featureimp.png" alt="" /></p>

<p>Both the validation score and the training score are increasing over increasing training examples, which suggests that it might be beneficial to add more training example. on the other hand, judging by the small F1 score increase over wide range (0 to ~25000 rows) of data, the score might increase but only very slightly.</p>

<p><img src="/portfolio/static/learningcurve.png" alt="" /></p>

<h2 id="making-use-of-the-model">Making Use of the Model</h2>

<ol>
  <li>Predict heat complaint at building/tax lot level</li>
  <li>Count the total heat complaints in a certain area (e.g. zip code)</li>
  <li>Choose the area with the highest number of complaints to focus on</li>
</ol>

<p>We will use our model prediction to ultimately count the total heat complaints in a certain area and then choose only the area with the highest number of complaints to focus on. Thus, we want to be as confident as possible when predicting whether a building will have a heat complaint or not -&gt; increase the threshold, for example, to 0.7 to increase the precision.</p>

<p>Threshold = 0.5</p>

<p><img src="/portfolio/static/threshold1.png" alt="" /></p>

<p>Threshold = 0.7</p>

<p><img src="/portfolio/static/threshold2.png" alt="" /></p>

<h2 id="prediction-example">Prediction Example</h2>

<p>Interpretation: According to our model, in the afternoon of a day in January in the area with zip code 11218 there are 32 heat complaints from total of 104 buildings</p>

<p><img src="/portfolio/static/prediction.png" alt="" /></p>

<h2 id="conclusion">Conclusion</h2>

<ul>
  <li>We have analyzed housing and buildings complaints and chose heating problems as the complaint we should focus on, more specifically in Bronx.</li>
  <li>We have analyzed the pattern related to heat complaints in comparison with non-heat complaints.</li>
  <li>We have built a model that predicts the type of complaint sent to the NYC 311 Service Call based on several available tax lot information.</li>
  <li>The model suffers from overfitting, but with threshold adjustment we can get a more confident prediction.</li>
</ul>

<h2 id="links">Links</h2>
<ul>
  <li>Flask web application is available on <a href="http://nyc311-azka.herokuapp.com/">Heroku</a></li>
  <li>Notebooks and source code are available on <a href="https://github.com/azukacchi/nyc311_housing_buildings_analysis">my github</a>.</li>
</ul>
:ET